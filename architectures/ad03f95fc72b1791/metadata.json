{
  "hash": "ad03f95fc72b1791",
  "source_url": "https://github.com/aws-samples/serverless-patterns/tree/main/apigw-lambda-dynamodb-terraform",
  "source_type": "github_repos",
  "discovered_at": "2026-01-11T08:20:41.719236",
  "services": [
    "dynamodb",
    "cloudwatch",
    "lambda",
    "apigateway",
    "iam",
    "s3"
  ],
  "resource_count": 15,
  "name": "aws-samples/serverless-patterns/apigw-lambda-dynamodb-terraform",
  "description": "Serverless patterns. Learn more at the website: https://serverlessland.com/patterns.",
  "version": "main",
  "skipped": false,
  "skip_reason": null,
  "original_format": null,
  "terraform_files": {
    "main.tf": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 5.0\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"~> 3.1.0\"\n    }\n    archive = {\n      source  = \"hashicorp/archive\"\n      version = \"~> 2.2.0\"\n    }\n  }\n\n  required_version = \">= 0.14.9\"\n}\n\nprovider \"aws\" {\n  profile = \"default\"\n  region = var.aws_region\n}\n\nresource \"random_string\" \"random\" {\n  length           = 4\n  special          = false\n}\n\nresource \"aws_dynamodb_table\" \"movie_table\" {\n  name           = var.dynamodb_table\n  billing_mode   = \"PROVISIONED\"\n  read_capacity  = 20\n  write_capacity = 20\n  hash_key       = \"year\"\n  range_key      = \"title\"\n\n  attribute {\n    name = \"year\"\n    type = \"N\"\n  }\n  \n  attribute {\n    name = \"title\"\n    type = \"S\"\n  }\n\n}\n\n#========================================================================\n// lambda setup\n#========================================================================\n\nresource \"aws_s3_bucket\" \"lambda_bucket\" {\n  bucket_prefix = var.s3_bucket_prefix\n  force_destroy = true\n}\n\nresource \"aws_s3_bucket_public_access_block\" \"private_bucket\" {\n  bucket = aws_s3_bucket.lambda_bucket.id\n\n  block_public_acls       = true\n  block_public_policy     = true\n  ignore_public_acls      = true\n  restrict_public_buckets = true\n}\n\ndata \"archive_file\" \"lambda_zip\" {\n  type = \"zip\"\n\n  source_dir  = \"${path.module}/src\"\n  output_path = \"${path.module}/src.zip\"\n}\n\nresource \"aws_s3_object\" \"this\" {\n  bucket = aws_s3_bucket.lambda_bucket.id\n\n  key    = \"src.zip\"\n  source = data.archive_file.lambda_zip.output_path\n\n  etag = filemd5(data.archive_file.lambda_zip.output_path)\n}\n\n//Define lambda function\nresource \"aws_lambda_function\" \"apigw_lambda_ddb\" {\n  function_name = \"${var.lambda_name}-${random_string.random.id}\"\n  description = \"serverlessland pattern\"\n\n  s3_bucket = aws_s3_bucket.lambda_bucket.id\n  s3_key    = aws_s3_object.this.key\n\n  runtime = \"python3.14\"\n  handler = \"app.lambda_handler\"\n\n  source_code_hash = data.archive_file.lambda_zip.output_base64sha256\n\n  role = aws_iam_role.lambda_exec.arn\n  \n  environment {\n    variables = {\n      DDB_TABLE = var.dynamodb_table\n    }\n  }\n  depends_on = [aws_cloudwatch_log_group.lambda_logs]\n  \n}\n\nresource \"aws_cloudwatch_log_group\" \"lambda_logs\" {\n  name = \"/aws/lambda/${var.lambda_name}-${random_string.random.id}\"\n\n  retention_in_days = var.lambda_log_retention\n}\n\nresource \"aws_iam_role\" \"lambda_exec\" {\n  name = \"LambdaDdbPost\"\n\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [{\n      Action = \"sts:AssumeRole\"\n      Effect = \"Allow\"\n      Sid    = \"\"\n      Principal = {\n        Service = \"lambda.amazonaws.com\"\n      }\n      }\n    ]\n  })\n}\n\nresource \"aws_iam_policy\" \"lambda_exec_role\" {\n  name = \"lambda-tf-pattern-ddb-post\"\n\n  policy = <<POLICY\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"dynamodb:GetItem\",\n                \"dynamodb:PutItem\",\n                \"dynamodb:UpdateItem\"\n            ],\n            \"Resource\": \"arn:aws:dynamodb:*:*:table/${var.dynamodb_table}\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"logs:CreateLogGroup\",\n                \"logs:CreateLogStream\",\n                \"logs:PutLogEvents\"\n            ],\n            \"Resource\": \"*\"\n        }\n    ]\n}\nPOLICY\n}\n\nresource \"aws_iam_role_policy_attachment\" \"lambda_policy\" {\n  role       = aws_iam_role.lambda_exec.name\n  policy_arn = aws_iam_policy.lambda_exec_role.arn\n}\n\n#========================================================================\n// API Gateway section\n#========================================================================\n\nresource \"aws_apigatewayv2_api\" \"http_lambda\" {\n  name          = \"${var.apigw_name}-${random_string.random.id}\"\n  protocol_type = \"HTTP\"\n}\n\nresource \"aws_apigatewayv2_stage\" \"default\" {\n  api_id = aws_apigatewayv2_api.http_lambda.id\n\n  name        = \"$default\"\n  auto_deploy = true\n\n  access_log_settings {\n    destination_arn = aws_cloudwatch_log_group.api_gw.arn\n\n    format = jsonencode({\n      requestId               = \"$context.requestId\"\n      sourceIp                = \"$context.identity.sourceIp\"\n      requestTime             = \"$context.requestTime\"\n      protocol                = \"$context.protocol\"\n      httpMethod              = \"$context.httpMethod\"\n      resourcePath            = \"$context.resourcePath\"\n      routeKey                = \"$context.routeKey\"\n      status                  = \"$context.status\"\n      responseLength          = \"$context.responseLength\"\n      integrationErrorMessage = \"$context.integrationErrorMessage\"\n      }\n    )\n  }\n  depends_on = [aws_cloudwatch_log_group.api_gw]\n}\n\nresource \"aws_apigatewayv2_integration\" \"apigw_lambda\" {\n  api_id = aws_apigatewayv2_api.http_lambda.id\n\n  integration_uri    = aws_lambda_function.apigw_lambda_ddb.invoke_arn\n  integration_type   = \"AWS_PROXY\"\n  integration_method = \"POST\"\n}\n\nresource \"aws_apigatewayv2_route\" \"post\" {\n  api_id = aws_apigatewayv2_api.http_lambda.id\n\n  route_key = \"POST /movies\"\n  target    = \"integrations/${aws_apigatewayv2_integration.apigw_lambda.id}\"\n}\n\nresource \"aws_cloudwatch_log_group\" \"api_gw\" {\n  name = \"/aws/api_gw/${var.apigw_name}-${random_string.random.id}\"\n\n  retention_in_days = var.apigw_log_retention\n}\n\nresource \"aws_lambda_permission\" \"api_gw\" {\n  statement_id  = \"AllowExecutionFromAPIGateway\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.apigw_lambda_ddb.function_name\n  principal     = \"apigateway.amazonaws.com\"\n\n  source_arn = \"${aws_apigatewayv2_api.http_lambda.execution_arn}/*/*\"\n}\n",
    "outputs.tf": "# Output value definitions\n\noutput \"apigwy_url\" {\n  description = \"URL for API Gateway stage\"\n\n  value = aws_apigatewayv2_stage.default.invoke_url\n}\n\noutput \"lambda_log_group\" {\n  description = \"Name of the CloudWatch logs group for the lambda function\"\n\n  value = aws_cloudwatch_log_group.lambda_logs.id\n}\n\noutput \"apigwy_log_group\" {\n  description = \"Name of the CloudWatch logs group for the lambda function\"\n\n  value = aws_cloudwatch_log_group.api_gw.id\n}",
    "variables.tf": "# Input variable definitions\n\nvariable \"aws_region\" {\n  description = \"AWS region for all resources.\"\n\n  type    = string\n  default = \"us-east-1\"\n}\n\nvariable \"s3_bucket_prefix\" {\n  description = \"S3 bucket prefix\"\n  type = string\n  default = \"apigw-lambda-ddb\"\n  \n}\n\nvariable \"dynamodb_table\" {\n  description = \"name of the ddb table\"\n  type = string\n  default = \"Movies\"\n  \n}\n\nvariable \"lambda_name\" {\n  description = \"name of the lambda function\"\n  type = string\n  default = \"pattern-movies-post\"\n  \n}\n\nvariable \"apigw_name\" {\n  description = \"name of the lambda function\"\n  type = string\n  default = \"apigw-http-lambda\"\n  \n}\n\nvariable \"lambda_log_retention\" {\n  description = \"lambda log retention in days\"\n  type = number\n  default = 7\n}\n\nvariable \"apigw_log_retention\" {\n  description = \"api gwy log retention in days\"\n  type = number\n  default = 7\n}"
  }
}