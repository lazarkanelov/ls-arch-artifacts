{
  "hash": "91934f8c031ad7ae",
  "source_url": "https://github.com/aws-samples/aws-security-services-with-terraform",
  "source_type": "github",
  "discovered_at": "2026-01-11T21:33:43.524092",
  "services": [
    "sns",
    "cloudwatch",
    "opensearch",
    "kinesis",
    "firehose",
    "lambda",
    "kms",
    "config",
    "s3",
    "ec2",
    "iam"
  ],
  "resource_count": 116,
  "name": "aws-security-services-with-terraform",
  "description": "Code examples for the AWS Security Blog post: How to use CI/CD to deploy and configure AWS security services with Terraform",
  "version": null,
  "skipped": false,
  "skip_reason": null,
  "original_format": null,
  "terraform_files": {
    "provider.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n## Specifies the Region your Terraform Provider will server\nprovider \"aws\" {\n  region = \"us-east-1\"\n}\n## Specifies the S3 Bucket and DynamoDB table used for the durable backend and state locking\n\nterraform {\n    backend \"s3\" {\n      encrypt = true\n      bucket = \"my_s3_bucket_name\"\n      dynamodb_table = \"my_dynamo_table_name\"\n      key = \"path/path/terraform.tfstate\"\n      region = \"us-east-1\"\n  }\n}",
    "variables.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n#################################\n## waf-conditions.tf Variables ##\n#################################\nvariable \"AWS_Security_Blog_Blacklist_IPSet_Name\" {\n  default = \"devsecopsblacklistipset\"\n}\nvariable \"AWS_Security_Blog_SQLI_Match_Set_Name\" {\n  default = \"devsecopssqlimatchset\"\n}\n\n############################\n## waf-rules.tf Variables ##\n############################\nvariable \"AWS_Security_Blog_IP_Blacklist_Rule_Name\" {\n  default = \"devsecopsblacklistrule\"\n}\nvariable \"AWS_Security_Blog_SQL_Injection_Rule_Name\" {\n  default = \"devsecopssqlirule\"\n}\nvariable \"AWS_Security_Blog_Blacklist_WACL_Name\" {\n  default = \"devsecopswebacl\"\n}",
    "waf-conditions.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n## Creates a WAF IP Set to be used as a Blacklist for a WAF Rule to add to the Web ACL\n## Value can be replaced with a Variable or a Static Value of an EIP within the customer VPC\n## to test functionality of the WAF blocking access via IP\nresource \"aws_waf_ipset\" \"AWS_Security_Blog_Blacklist_IPSet\" {\n  name = \"${var.AWS_Security_Blog_Blacklist_IPSet_Name}\"\n  ip_set_descriptors {\n    type  = \"IPV4\"\n    value = \"10.0.0.99/32\"\n  }\n}\n## Creates SQL Injection match condition with multiple filters based on AWS best practices\n## reccomendations from the Mitigated OWASP Top 10 with AWS WAF White Paper\nresource \"aws_waf_sql_injection_match_set\" \"AWS_Security_Blog_SQLI_Match_Set\" {\n  name = \"${var.AWS_Security_Blog_SQLI_Match_Set_Name}\"\n  sql_injection_match_tuples {\n    text_transformation = \"HTML_ENTITY_DECODE\"\n    field_to_match {\n      type = \"QUERY_STRING\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"URL_DECODE\"\n    field_to_match {\n      type = \"QUERY_STRING\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"HTML_ENTITY_DECODE\"\n    field_to_match {\n      type = \"URI\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"URL_DECODE\"\n    field_to_match {\n      type = \"URI\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"HTML_ENTITY_DECODE\"\n    field_to_match {\n      type = \"BODY\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"URL_DECODE\"\n    field_to_match {\n      type = \"BODY\"\n    }\n  }  \n  sql_injection_match_tuples {\n    text_transformation = \"HTML_ENTITY_DECODE\"\n    field_to_match {\n      type = \"HEADER\"\n      data = \"Cookie\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"URL_DECODE\"\n    field_to_match {\n      type = \"HEADER\"\n      data = \"Cookie\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"HTML_ENTITY_DECODE\"\n    field_to_match {\n      type = \"HEADER\"\n      data = \"Authorization\"\n    }\n  }\n  sql_injection_match_tuples {\n    text_transformation = \"URL_DECODE\"\n    field_to_match {\n      type = \"HEADER\"\n      data = \"Authorization\"\n    }\n  }\n}",
    "waf-rules.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n\n## Creates an AWS WAF Rule to Blacklist the IP Address specified in the IPSet Condition\nresource \"aws_waf_rule\" \"AWS_Security_Blog_IP_Blacklist_Rule\" {\n  name        = \"${var.AWS_Security_Blog_IP_Blacklist_Rule_Name}\"\n  metric_name = \"${var.AWS_Security_Blog_IP_Blacklist_Rule_Name}\"\n  predicates {\n    data_id = \"${aws_waf_ipset.AWS_Security_Blog_Blacklist_IPSet.id}\"\n    negated = false\n    type    = \"IPMatch\"\n  }\n}\n## Creates an AWS WAF Rule matched against Conditions listed in the SQL Injection Condition Match Set\nresource \"aws_waf_rule\" \"AWS_Security_Blog_SQL_Injection_Rule\" {\n  name        = \"${var.AWS_Security_Blog_SQL_Injection_Rule_Name}\"\n  metric_name = \"${var.AWS_Security_Blog_SQL_Injection_Rule_Name}\"\n  predicates{\n    data_id = \"${aws_waf_sql_injection_match_set.AWS_Security_Blog_SQLI_Match_Set.id}\"\n    negated = false\n    type = \"SqlInjectionMatch\"\n  }\n}\n## Creates an AWS WAF Web ACL that will Block traffic originiating from the Blacklist, as well as block traffic\n## that matches any SQL Injection methods. Logs are sent to a Kinesis Data Firehose for further processing and investigation\nresource \"aws_waf_web_acl\" \"AWS_Security_Blog_Blacklist_WACL\" {\n  name        = \"${var.AWS_Security_Blog_Blacklist_WACL_Name}\"\n  metric_name = \"${var.AWS_Security_Blog_Blacklist_WACL_Name}\"\n  default_action {\n    type = \"ALLOW\"\n  }\n  rules {\n    action {\n      type = \"BLOCK\"\n    }\n    priority = 1\n    rule_id  = \"${aws_waf_rule.AWS_Security_Blog_SQL_Injection_Rule.id}\"\n    type     = \"REGULAR\"\n  }\n  rules {\n    action {\n      type = \"BLOCK\"\n    }\n    priority = 2\n    rule_id  = \"${aws_waf_rule.AWS_Security_Blog_IP_Blacklist_Rule.id}\"\n    type     = \"REGULAR\"\n  }\n}",
    "aws-security-hub-boostrap-and-operationalization/cis_3-x.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n# SNS topic to receive CIS 3.x alerts\n# You will need to subscribe via email manually as this is unsupported by terraform\nresource \"aws_sns_topic\" \"CIS_Alerts_SNS_Topic\" {\n  name_prefix = \"${var.CIS_SNS_Prefix}\"\n}\n## These next resources are the CloudWatch Log Metric Filter & associated Alarms to be in compliance with CIS Benchmarks\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Unauthorized_API_Calls_Metric_Filter\" {\n  name           = \"CIS-UnauthorizedAPICalls\"\n  pattern        = \"{ ($.errorCode = \\\"*UnauthorizedOperation\\\") || ($.errorCode = \\\"AccessDenied*\\\") }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-UnauthorizedAPICalls\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Unauthorized_API_Calls_CW_Alarm\" {\n  alarm_name                = \"CIS-3.1-UnauthorizedAPICalls\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Unauthorized_API_Calls_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring unauthorized API calls will help reveal application errors and may reduce time to detect malicious activity.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_No_MFA_Console_Signin_Metric_Filter\" {\n  name           = \"CIS-ConsoleSigninWithoutMFA\"\n  pattern        = \"{ ($.eventName = \\\"ConsoleLogin\\\") && ($.additionalEventData.MFAUsed != \\\"Yes\\\") }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-ConsoleSigninWithoutMFA\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\n\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_No_MFA_Console_Signin_CW_Alarm\" {\n  alarm_name                = \"CIS-3.2-ConsoleSigninWithoutMFA\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_No_MFA_Console_Signin_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring for single-factor console logins will increase visibility into accounts that are not protected by MFA.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\n\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Root_Account_Use_Metric_Filter\" {\n  name           = \"CIS-RootAccountUsage\"\n  pattern        = \"{ $.userIdentity.type = \\\"Root\\\" && $.userIdentity.invokedBy NOT EXISTS && $.eventType != \\\"AwsServiceEvent\\\" }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-RootAccountUsage\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\n\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Root_Account_Use_CW_Alarm\" {\n  alarm_name                = \"CIS-3.3-RootAccountUsage\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Root_Account_Use_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring for root account logins will provide visibility into the use of a fully privileged account and an opportunity to reduce the use of it.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_IAM_Policy_Change_Metric_Filter\" {\n  name           = \"CIS-IAMPolicyChanges\"\n  pattern        = \"{($.eventName=DeleteGroupPolicy)||($.eventName=DeleteRolePolicy)||($.eventName=DeleteUserPolicy)||($.eventName=PutGroupPolicy)||($.eventName=PutRolePolicy)||($.eventName=PutUserPolicy)||($.eventName=CreatePolicy)||($.eventName=DeletePolicy)||($.eventName=CreatePolicyVersion)||($.eventName=DeletePolicyVersion)||($.eventName=AttachRolePolicy)||($.eventName=DetachRolePolicy)||($.eventName=AttachUserPolicy)||($.eventName=DetachUserPolicy)||($.eventName=AttachGroupPolicy)||($.eventName=DetachGroupPolicy)}\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-IAMPolicyChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_IAM_Policy_Change_CW_Alarm\" {\n  alarm_name                = \"CIS-3.4-IAMPolicyChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_IAM_Policy_Change_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to IAM policies will help ensure authentication and authorization controls remain intact.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_CloudTrail_Config_Change_Metric_Filter\" {\n  name           = \"CIS-CloudTrailChanges\"\n  pattern        = \"{ ($.eventName = CreateTrail) || ($.eventName = UpdateTrail) || ($.eventName = DeleteTrail) || ($.eventName = StartLogging) || ($.eventName = StopLogging) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-CloudTrailChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_CloudTrail_Config_Change_CW_Alarm\" {\n  alarm_name                = \"CIS-3.5-CloudTrailChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_CloudTrail_Config_Change_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to CloudTrail's configuration will help ensure sustained visibility to activities performed in the AWS account.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Console_AuthN_Failure_Metric_Filter\" {\n  name           = \"CIS-ConsoleAuthenticationFailure\"\n  pattern        = \"{ ($.eventName = ConsoleLogin) && ($.errorMessage = \\\"Failed authentication\\\") }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-ConsoleAuthenticationFailure\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Console_AuthN_Failure_CW_Alarm\" {\n  alarm_name                = \"CIS-3.6-ConsoleAuthenticationFailure\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Console_AuthN_Failure_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring failed console logins may decrease lead time to detect an attempt to brute force a credential, which may provide an indicator, such as source IP, that can be used in other event correlation.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Disable_Or_Delete_CMK_Metric_Filter\" {\n  name           = \"CIS-DisableOrDeleteCMK\"\n  pattern        = \"{ ($.eventSource = kms.amazonaws.com) && (($.eventName = DisableKey) || ($.eventName = ScheduleKeyDeletion)) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-DisableOrDeleteCMK\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Disable_Or_Delete_CMK_CW_Alarm\" {\n  alarm_name                = \"CIS-3.7-DisableOrDeleteCMK\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Disable_Or_Delete_CMK_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring failed console logins may decrease lead time to detect an attempt to brute force a credential, which may provide an indicator, such as source IP, that can be used in other event correlation.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_S3_Bucket_Policy_Change_Metric_Filter\" {\n  name           = \"CIS-S3BucketPolicyChanges\"\n  pattern        = \"{ ($.eventSource = s3.amazonaws.com) && (($.eventName = PutBucketAcl) || ($.eventName = PutBucketPolicy) || ($.eventName = PutBucketCors) || ($.eventName = PutBucketLifecycle) || ($.eventName = PutBucketReplication) || ($.eventName = DeleteBucketPolicy) || ($.eventName = DeleteBucketCors) || ($.eventName = DeleteBucketLifecycle) || ($.eventName = DeleteBucketReplication)) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-S3BucketPolicyChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_S3_Bucket_Policy_Change_CW_Alarm\" {\n  alarm_name                = \"CIS-3.8-S3BucketPolicyChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_S3_Bucket_Policy_Change_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to S3 bucket policies may reduce time to detect and correct permissive policies on sensitive S3 buckets.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_AWS_Config_Change_Metric_Filter\" {\n  name           = \"CIS-AWSConfigChanges\"\n  pattern        = \"{ ($.eventSource = config.amazonaws.com) && (($.eventName=StopConfigurationRecorder)||($.eventName=DeleteDeliveryChannel)||($.eventName=PutDeliveryChannel)||($.eventName=PutConfigurationRecorder)) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-AWSConfigChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_AWS_Config_Change_CW_Alarm\" {\n  alarm_name                = \"CIS-3.9-AWSConfigChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_AWS_Config_Change_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to AWS Config configuration will help ensure sustained visibility of configuration items within the AWS account.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Security_Group_Changes_Metric_Filter\" {\n  name           = \"CIS-SecurityGroupChanges\"\n  pattern        = \"{ ($.eventName = AuthorizeSecurityGroupIngress) || ($.eventName = AuthorizeSecurityGroupEgress) || ($.eventName = RevokeSecurityGroupIngress) || ($.eventName = RevokeSecurityGroupEgress) || ($.eventName = CreateSecurityGroup) || ($.eventName = DeleteSecurityGroup)}\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-SecurityGroupChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Security_Group_Changes_CW_Alarm\" {\n  alarm_name                = \"CIS-3.10-SecurityGroupChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Security_Group_Changes_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to security group will help ensure that resources and services are not unintentionally exposed.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Network_ACL_Changes_Metric_Filter\" {\n  name           = \"CIS-NetworkACLChanges\"\n  pattern        = \"{ ($.eventName = CreateNetworkAcl) || ($.eventName = CreateNetworkAclEntry) || ($.eventName = DeleteNetworkAcl) || ($.eventName = DeleteNetworkAclEntry) || ($.eventName = ReplaceNetworkAclEntry) || ($.eventName = ReplaceNetworkAclAssociation) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-NetworkACLChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Network_ACL_Changes_CW_Alarm\" {\n  alarm_name                = \"CIS-3.11-NetworkACLChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Network_ACL_Changes_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to NACLs will help ensure that AWS resources and services are not unintentionally exposed.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Network_Gateway_Changes_Metric_Filter\" {\n  name           = \"CIS-NetworkGatewayChanges\"\n  pattern        = \"{ ($.eventName = CreateCustomerGateway) || ($.eventName = DeleteCustomerGateway) || ($.eventName = AttachInternetGateway) || ($.eventName = CreateInternetGateway) || ($.eventName = DeleteInternetGateway) || ($.eventName = DetachInternetGateway) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-NetworkGatewayChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Network_Gateway_Changes_CW_Alarm\" {\n  alarm_name                = \"CIS-3.12-NetworkGatewayChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Network_Gateway_Changes_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to network gateways will help ensure that all ingress/egress traffic traverses the VPC border via a controlled path.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_Route_Table_Changes_Metric_Filter\" {\n  name           = \"CIS-RouteTableChanges\"\n  pattern        = \"{ ($.eventName = CreateRoute) || ($.eventName = CreateRouteTable) || ($.eventName = ReplaceRoute) || ($.eventName = ReplaceRouteTableAssociation) || ($.eventName = DeleteRouteTable) || ($.eventName = DeleteRoute) || ($.eventName = DisassociateRouteTable) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-RouteTableChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_Route_Table_Changes_CW_Alarm\" {\n  alarm_name                = \"CIS-3.13-RouteTableChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_Route_Table_Changes_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to route tables will help ensure that all VPC traffic flows through an expected path.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\nresource \"aws_cloudwatch_log_metric_filter\" \"CIS_VPC_Changes_Metric_Filter\" {\n  name           = \"CIS-VPCChanges\"\n  pattern        = \"{ ($.eventName = CreateVpc) || ($.eventName = DeleteVpc) || ($.eventName = ModifyVpcAttribute) || ($.eventName = AcceptVpcPeeringConnection) || ($.eventName = CreateVpcPeeringConnection) || ($.eventName = DeleteVpcPeeringConnection) || ($.eventName = RejectVpcPeeringConnection) || ($.eventName = AttachClassicLinkVpc) || ($.eventName = DetachClassicLinkVpc) || ($.eventName = DisableVpcClassicLink) || ($.eventName = EnableVpcClassicLink) }\"\n  log_group_name = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n\n  metric_transformation {\n    name      = \"CIS-VPCChanges\"\n    namespace = \"${var.CIS_Metric_Alarm_Namespace}\"\n    value     = \"1\"\n  }\n}\nresource \"aws_cloudwatch_metric_alarm\" \"CIS_VPC_Changes_CW_Alarm\" {\n  alarm_name                = \"CIS-3.14-VPCChanges\"\n  comparison_operator       = \"GreaterThanOrEqualToThreshold\"\n  evaluation_periods        = \"1\"\n  metric_name               = \"${aws_cloudwatch_log_metric_filter.CIS_VPC_Changes_Metric_Filter.id}\"\n  namespace                 = \"${var.CIS_Metric_Alarm_Namespace}\"\n  period                    = \"300\"\n  statistic                 = \"Sum\"\n  threshold                 = \"1\"\n  alarm_description         = \"Monitoring changes to VPC will help ensure that all VPC traffic flows through an expected path.\"\n  alarm_actions             = [\"${aws_sns_topic.CIS_Alerts_SNS_Topic.arn}\"]\n  insufficient_data_actions = []\n}\n",
    "aws-security-hub-boostrap-and-operationalization/cis_baseline_infrastructure.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n# create KMS key with default cloudtrail policy\nresource \"aws_kms_key\" \"Cloudtrail_KMS_CMK\" {\n  description             = \"For CloudTrail - Managed by Terraform\"\n  deletion_window_in_days = 7\n  is_enabled              = true\n  enable_key_rotation     = true\n  policy                  = <<POLICY\n{\n    \"Version\": \"2012-10-17\",\n    \"Id\": \"Key policy created by CloudTrail\",\n    \"Statement\": [\n        {\n            \"Sid\": \"Enable IAM User Permissions\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"AWS\": [\n                \"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\"\n            ]},\n            \"Action\": \"kms:*\",\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"Allow CloudTrail to encrypt logs\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"Service\": [\"cloudtrail.amazonaws.com\"]},\n            \"Action\": \"kms:GenerateDataKey*\",\n            \"Resource\": \"*\",\n            \"Condition\": {\"StringLike\": {\"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:${data.aws_caller_identity.current.account_id}:trail/*\"}}\n        },\n        {\n            \"Sid\": \"Allow CloudTrail to describe key\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"Service\": [\"cloudtrail.amazonaws.com\"]},\n            \"Action\": \"kms:DescribeKey\",\n            \"Resource\": \"*\"\n        },\n        {\n            \"Sid\": \"Allow principals in the account to decrypt log files\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"AWS\": \"*\"},\n            \"Action\": [\n                \"kms:Decrypt\",\n                \"kms:ReEncryptFrom\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\"kms:CallerAccount\": \"${data.aws_caller_identity.current.account_id}\"},\n                \"StringLike\": {\"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:${data.aws_caller_identity.current.account_id}:trail/*\"}\n            }\n        },\n        {\n            \"Sid\": \"Allow alias creation during setup\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"AWS\": \"*\"},\n            \"Action\": \"kms:CreateAlias\",\n            \"Resource\": \"*\",\n            \"Condition\": {\"StringEquals\": {\n                \"kms:ViaService\": \"ec2.${var.AWS_REGION}.amazonaws.com\",\n                \"kms:CallerAccount\": \"${data.aws_caller_identity.current.account_id}\"\n            }}\n        },\n        {\n            \"Sid\": \"Enable cross account log decryption\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"AWS\": \"*\"},\n            \"Action\": [\n                \"kms:Decrypt\",\n                \"kms:ReEncryptFrom\"\n            ],\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEquals\": {\"kms:CallerAccount\": \"${data.aws_caller_identity.current.account_id}\"},\n                \"StringLike\": {\"kms:EncryptionContext:aws:cloudtrail:arn\": \"arn:aws:cloudtrail:*:${data.aws_caller_identity.current.account_id}:trail/*\"}\n            }\n        }\n    ]\n}\nPOLICY\n}\n# Create IAM Password Policy in accordance with CIS 1.5 - 1.11 controls\nresource \"aws_iam_account_password_policy\" \"CIS_Password_Policy\" {\n  minimum_password_length        = 15\n  require_lowercase_characters   = true\n  require_numbers                = true\n  require_uppercase_characters   = true\n  require_symbols                = true\n  allow_users_to_change_password = true\n  max_password_age               = 90\n  password_reuse_prevention      = 24\n}\n# Create S3 Bucket for Access logging\nresource \"aws_s3_bucket\" \"Server_Access_Log_S3_Bucket\" {\n  bucket_prefix = \"${var.AccessLog_Bucket_Prefix}\"\n  acl    = \"log-delivery-write\"\n  versioning {\n      enabled = true\n  }\n  server_side_encryption_configuration {\n    rule {\n      apply_server_side_encryption_by_default {\n        sse_algorithm     = \"AES256\"\n      }\n    }\n  }\n}\n# create cloudwatch log group for cloudtrail to write to, will be used by 3.x cloudwatch metrics & filters\nresource \"aws_cloudwatch_log_group\" \"CIS_CloudWatch_LogsGroup\" {\n  name = \"${var.CIS_CloudTrail_Trail_Name}-log-group\"\n}\n# create IAM role and policy to allow cloudtrail to write logs to cloudwatch\nresource \"aws_iam_role\" \"CloudWatch_LogsGroup_IAM_Role\" {\n  name = \"${var.CIS_CloudTrail_Trail_Name}-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"cloudtrail.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"CIS_CloudWatch_LogsGroup_Policy\" {\n  name   = \"${var.CIS_CloudTrail_Trail_Name}-policy\"\n  role   = \"${aws_iam_role.CloudWatch_LogsGroup_IAM_Role.id}\"\n  policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\",\n        \"logs:DescribeLogGroups\",\n        \"logs:DescribeLogStreams\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.arn}*\"\n    }\n  ]\n}\nEOF\n}\n# create a CloudTrail trail that is compliant with CIS controls (2.1, 2.2, 2.4)\nresource \"aws_cloudtrail\" \"CIS_CloudTrail_Trail\" { \n  name                          = \"${var.CIS_CloudTrail_Trail_Name}\" \n  s3_bucket_name                = \"${aws_s3_bucket.CIS_CloudTrail_Logs_S3_Bucket.id}\"\n  include_global_service_events = true\n  is_multi_region_trail         = true\n  enable_log_file_validation    = true\n  kms_key_id                    = \"${aws_kms_key.Cloudtrail_KMS_CMK.arn}\"\n  cloud_watch_logs_group_arn    = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.arn}\"\n  cloud_watch_logs_role_arn     = \"${aws_iam_role.CloudWatch_LogsGroup_IAM_Role.arn}\"\n  depends_on                    = [\"aws_s3_bucket_policy.CloudTrail_Bucket_Policy\"]\n  event_selector {\n    read_write_type           = \"All\"\n    include_management_events = true\n  }\n}\n# create bucket and bucket policy for CloudTrail logs, compliant with CIS controls (2.3, 2.6)\nresource \"aws_s3_bucket\" \"CIS_CloudTrail_Logs_S3_Bucket\" {  \n  bucket_prefix = \"${var.CloudTrail_Bucket_Prefix}\" \n  acl           = \"private\"\n  versioning {\n      enabled = true\n  }\n  logging {\n    target_bucket = \"${aws_s3_bucket.Server_Access_Log_S3_Bucket.id}\"\n    target_prefix = \"cloudtrailaccess/\"\n  }\n  server_side_encryption_configuration {\n    rule {\n      apply_server_side_encryption_by_default {\n        sse_algorithm     = \"AES256\"\n      }\n    }\n  }\n}\nresource \"aws_s3_bucket_policy\" \"CloudTrail_Bucket_Policy\" {\n  bucket = \"${aws_s3_bucket.CIS_CloudTrail_Logs_S3_Bucket.id}\"\n  policy = <<POLICY\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Sid\": \"AWSCloudTrailAclCheck20150319\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"Service\": \"cloudtrail.amazonaws.com\"},\n            \"Action\": \"s3:GetBucketAcl\",\n            \"Resource\": \"${aws_s3_bucket.CIS_CloudTrail_Logs_S3_Bucket.arn}\"\n        },\n        {\n            \"Sid\": \"AWSCloudTrailWrite20150319\",\n            \"Effect\": \"Allow\",\n            \"Principal\": {\"Service\": \"cloudtrail.amazonaws.com\"},\n            \"Action\": \"s3:PutObject\",\n            \"Resource\": \"${aws_s3_bucket.CIS_CloudTrail_Logs_S3_Bucket.arn}/*\",\n            \"Condition\": {\"StringEquals\": {\"s3:x-amz-acl\": \"bucket-owner-full-control\"}}\n        }\n    ]\n}\nPOLICY\n}\n# Creates a reference VPC with private and public subnets\nresource \"aws_vpc\" \"CIS_VPC\" {\n  cidr_block           = \"${var.CIS_VPC_CIDR}\"\n  enable_dns_support   = true\n  enable_dns_hostnames = true\n  tags {\n      Name = \"${var.CIS_VPC_Name_Tag}\"\n  }\n}\n# create subnets\nresource \"aws_subnet\" \"CIS_Public_Subnets\" {\n  count                   = \"${var.Network_Resource_Count}\"\n  vpc_id                  = \"${aws_vpc.CIS_VPC.id}\"\n  cidr_block              = \"${cidrsubnet(aws_vpc.CIS_VPC.cidr_block, 8, var.Network_Resource_Count + count.index)}\"\n  availability_zone       = \"${data.aws_availability_zones.Available_AZ.names[count.index]}\"\n  map_public_ip_on_launch = true\n  tags {\n    Name = \"${var.CIS_VPC_Name_Tag}-PUB-Subnet-${element(data.aws_availability_zones.Available_AZ.names, count.index)}\"\n  }\n}\nresource \"aws_subnet\" \"CIS_Private_Subnets\" {\n  count             = \"${var.Network_Resource_Count}\"\n  vpc_id            = \"${aws_vpc.CIS_VPC.id}\"\n  cidr_block        = \"${cidrsubnet(aws_vpc.CIS_VPC.cidr_block, 8, count.index)}\"\n  availability_zone = \"${data.aws_availability_zones.Available_AZ.names[count.index]}\"\n  tags {\n    Name = \"${var.CIS_VPC_Name_Tag}-PRIV-Subnet-${element(data.aws_availability_zones.Available_AZ.names, count.index)}\"\n  }\n}\n# attach IGW\nresource \"aws_internet_gateway\" \"CIS_IGW\" {\n  vpc_id = \"${aws_vpc.CIS_VPC.id}\"\n  tags {\n      Name = \"${var.CIS_VPC_Name_Tag}-IGW\"\n  }\n}\n# create route tables, route table associations and nat gateway\nresource \"aws_route_table\" \"CIS_Public_RTB\" {\n  count  = \"${var.Network_Resource_Count}\"\n  vpc_id = \"${aws_vpc.CIS_VPC.id}\"\n  route {\n      cidr_block = \"0.0.0.0/0\"\n      gateway_id = \"${aws_internet_gateway.CIS_IGW.id}\"\n  }\n  tags {\n    Name = \"PUB-RTB-${element(aws_subnet.CIS_Public_Subnets.*.id, count.index)}\"\n  }\n}\nresource \"aws_eip\" \"NATGW_Elastic_IPs\" {\n  count      = \"${var.Network_Resource_Count}\"\n  vpc        = true\n  depends_on = [\"aws_internet_gateway.CIS_IGW\"]\n  tags {\n    Name = \"NAT-Gateway-EIP-${element(aws_subnet.CIS_Public_Subnets.*.id, count.index)}\"\n  }\n}\nresource \"aws_nat_gateway\" \"CIS_NAT_Gateway\" {\n  count         = \"${var.Network_Resource_Count}\"\n  subnet_id     = \"${element(aws_subnet.CIS_Public_Subnets.*.id, count.index)}\"\n  allocation_id = \"${element(aws_eip.NATGW_Elastic_IPs.*.id, count.index)}\"\n  tags {\n    Name = \"NAT-Gateway-${element(aws_subnet.CIS_Public_Subnets.*.id, count.index)}\"\n  }\n}\nresource \"aws_route_table\" \"CIS_Private_RTB\" {\n  count  = \"${var.Network_Resource_Count}\"\n  vpc_id = \"${aws_vpc.CIS_VPC.id}\"\n  route {\n    cidr_block = \"0.0.0.0/0\"\n    nat_gateway_id = \"${element(aws_nat_gateway.CIS_NAT_Gateway.*.id, count.index)}\"\n  }\n  tags {\n    Name = \"PRIV-RTB-${element(aws_subnet.CIS_Private_Subnets.*.id, count.index)}\"\n  }\n}\nresource \"aws_route_table_association\" \"Public_Subnet_Association\" {\n  count          = \"${var.Network_Resource_Count}\"\n  subnet_id      = \"${element(aws_subnet.CIS_Public_Subnets.*.id, count.index)}\"\n  route_table_id = \"${element(aws_route_table.CIS_Public_RTB.*.id, count.index)}\"\n}\nresource \"aws_route_table_association\" \"Private_Subnet_Association\" {\n  count          = \"${var.Network_Resource_Count}\"\n  subnet_id      = \"${element(aws_subnet.CIS_Private_Subnets.*.id, count.index)}\"\n  route_table_id = \"${element(aws_route_table.CIS_Private_RTB.*.id, count.index)}\"\n}\n# enable flow logging for the vpc\nresource \"aws_flow_log\" \"CIS_VPC_Flow_Log\" {\n  iam_role_arn    = \"${aws_iam_role.CIS_FlowLogs_to_CWL_Role.arn}\"\n  log_destination = \"${aws_cloudwatch_log_group.CIS_FlowLogs_CWL_Group.arn}\"\n  traffic_type    = \"ALL\"\n  vpc_id          = \"${aws_vpc.CIS_VPC.id}\"\n}\nresource \"aws_cloudwatch_log_group\" \"CIS_FlowLogs_CWL_Group\" {\n  name = \"${var.CIS_VPC_Name_Tag}-flowlog-group\"\n}\n# create role & policy to allow VPC to send flow logs to cloudwatch\nresource \"aws_iam_role\" \"CIS_FlowLogs_to_CWL_Role\" {\n  name = \"${var.CIS_VPC_Name_Tag}-flowlog-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"vpc-flow-logs.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"CIS_FlowLogs_to_CWL_Role_Policy\" {\n  name = \"${var.CIS_VPC_Name_Tag}-flowlog-policy\"\n  role = \"${aws_iam_role.CIS_FlowLogs_to_CWL_Role.id}\"\n  policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\",\n        \"logs:DescribeLogGroups\",\n        \"logs:DescribeLogStreams\"\n      ],\n      \"Effect\": \"Allow\",\n      \"Resource\": \"${aws_cloudwatch_log_group.CIS_FlowLogs_CWL_Group.arn}*\"\n    }\n  ]\n}\nEOF\n}\n# remove rules from default SG\nresource \"aws_default_security_group\" \"Default_Security_Group\" {\n  vpc_id = \"${aws_vpc.CIS_VPC.id}\"\n  tags {\n    Name = \"DEFAULT_DO_NOT_USE\"\n  }\n}\nresource \"aws_security_group\" \"CIS_Linux_SG\" {\n  name        = \"cis-linux-sg\"\n  description = \"Allows 443 in and 22 from trusted IP ranges - Managed by Terraform\"\n  vpc_id      = \"${aws_vpc.CIS_VPC.id}\"\n  ingress {\n    from_port   = 22\n    to_port     = 22\n    protocol    = \"tcp\"\n    cidr_blocks = [\"${var.TRUSTED_IP}\"]\n  }\n  ingress {\n    from_port   = 443\n    to_port     = 443\n    protocol    = \"tcp\"\n    cidr_blocks = [\"0.0.0.0/0\"]\n  }\n  egress {\n    from_port       = 0\n    to_port         = 0\n    protocol        = \"-1\"\n    cidr_blocks     = [\"0.0.0.0/0\"]\n  }\n  tags {\n      Name = \"${var.CIS_VPC_Name_Tag}-Linux-SG\"\n  }\n}",
    "aws-security-hub-boostrap-and-operationalization/config.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n# Create Config Role\nresource \"aws_iam_role\" \"Config_IAM_Role\" {\n  name = \"Terraform-ConfigRole\"\n\n  assume_role_policy = <<POLICY\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"config.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\nPOLICY\n}\nresource \"aws_iam_role_policy_attachment\" \"Config_Role_Attach_Policy\" {\n  role       = \"${aws_iam_role.Config_IAM_Role.name}\"\n  policy_arn = \"arn:aws:iam::aws:policy/service-role/AWSConfigRole\"\n}\n# Create Config Recorder Bucket\nresource \"aws_s3_bucket\" \"Config_Recorder_Bucket\" {\n  bucket_prefix = \"${var.Config_Bucket_Prefix}\"\n  acl           = \"private\"\n  versioning {\n    enabled = true\n  }\n  server_side_encryption_configuration {\n    rule {\n      apply_server_side_encryption_by_default {\n        sse_algorithm     = \"AES256\"\n      }\n    }\n  }\n  lifecycle_rule {\n    enabled = true\n    expiration {\n      days = 365\n    }\n    noncurrent_version_expiration {\n      days = 365\n    }\n  }\n}\n# Default Config bucket access policy\nresource \"aws_s3_bucket_policy\" \"Config_Recorder_Bucket_Policy\" {\n  bucket = \"${aws_s3_bucket.Config_Recorder_Bucket.id}\"\n  policy = <<POLICY\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Sid\": \"Allow bucket ACL check\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": [\n         \"config.amazonaws.com\"\n        ]\n      },\n      \"Action\": \"s3:GetBucketAcl\",\n      \"Resource\": \"${aws_s3_bucket.Config_Recorder_Bucket.arn}\",\n      \"Condition\": {\n        \"Bool\": {\n          \"aws:SecureTransport\": \"true\"\n        }\n      }\n    },\n    {\n      \"Sid\": \"Allow bucket write\",\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": [\n         \"config.amazonaws.com\"\n        ]\n      },\n      \"Action\": \"s3:PutObject\",\n      \"Resource\": \"${aws_s3_bucket.Config_Recorder_Bucket.arn}/AWSLogs/${data.aws_caller_identity.current.account_id}/Config/*\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"s3:x-amz-acl\": \"bucket-owner-full-control\"\n        },\n        \"Bool\": {\n          \"aws:SecureTransport\": \"true\"\n        }\n      }\n    },\n    {\n      \"Sid\": \"Require SSL\",\n      \"Effect\": \"Deny\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Action\": \"s3:*\",\n      \"Resource\": \"${aws_s3_bucket.Config_Recorder_Bucket.arn}/*\",\n      \"Condition\": {\n        \"Bool\": {\n          \"aws:SecureTransport\": \"false\"\n        }\n      }\n    }\n  ]\n}\nPOLICY\n}\n# Create & Enable Config Recorder\nresource \"aws_config_configuration_recorder\" \"Config_Recorder\" {\n  role_arn = \"${aws_iam_role.Config_IAM_Role.arn}\"\n  recording_group {\n    all_supported                 = true\n    include_global_resource_types = true\n  }\n}\nresource \"aws_config_delivery_channel\" \"Config_Delivery_Channel\" {\n  name           = \"config-example\"\n  s3_bucket_name = \"${aws_s3_bucket.Config_Recorder_Bucket.bucket}\"\n  snapshot_delivery_properties {\n    delivery_frequency = \"${var.Config_Delivery_Frequency}\"\n  }\n  depends_on = [\"aws_config_configuration_recorder.Config_Recorder\"]\n}\nresource \"aws_config_configuration_recorder_status\" \"Config_Recorder_Enabled\" {\n  name       = \"${aws_config_configuration_recorder.Config_Recorder.name}\"\n  is_enabled = true\n  depends_on = [\"aws_config_delivery_channel.Config_Delivery_Channel\"]\n}",
    "aws-security-hub-boostrap-and-operationalization/data.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n# Account ID var\ndata \"aws_caller_identity\" \"current\" {}\n# Availability Zones var\ndata \"aws_availability_zones\" \"Available_AZ\" {\n  state = \"available\"\n}",
    "aws-security-hub-boostrap-and-operationalization/elasticsearch_siem_extension.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n###################\n# CLOUDTRAIL LOGS #\n###################\n# create an IAM role and policy that allows kinesis data firehose to interact with\n# elasticsearch and kinesis data streams\nresource \"aws_iam_role\" \"Cloudtrail_Firehose_Delivery_Role\" {\n  name = \"cloudtrail-firehose-siem-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"firehose.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"sts:ExternalId\":\"${data.aws_caller_identity.current.account_id}\"\n        }\n      }\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"Cloudtrail_Firehose_Delivery_Policy\" {\n  name   = \"cloudtrail-firehose-siem-policy\"\n  role   = \"${aws_iam_role.Cloudtrail_Firehose_Delivery_Role.id}\"\n  policy = <<EOF\n{\n    \"Version\": \"2012-10-17\",  \n    \"Statement\": [    \n        {      \n            \"Effect\": \"Allow\",      \n            \"Action\": [        \n                \"s3:AbortMultipartUpload\",        \n                \"s3:GetBucketLocation\",        \n                \"s3:GetObject\",        \n                \"s3:ListBucket\",        \n                \"s3:ListBucketMultipartUploads\",\n                \"s3:HeadBucket\",       \n                \"s3:PutObject\"\n            ],      \n            \"Resource\": [        \n                \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}\",\n                \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}/*\"\t\t    \n            ]    \n        },\n        {\n           \"Effect\": \"Allow\",\n           \"Action\": [\n               \"kms:Decrypt\",\n               \"kms:GenerateDataKey\"\n           ],\n           \"Resource\": [\n               \"*\"           \n           ]\n        },\n        {\n           \"Effect\": \"Allow\",\n           \"Action\": [\n               \"es:DescribeElasticsearchDomain\",\n               \"es:DescribeElasticsearchDomains\",\n               \"es:DescribeElasticsearchDomainConfig\",\n               \"es:ESHttpPost\",\n               \"es:ESHttpPut\"\n           ],\n          \"Resource\": [\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/*\"\n          ]\n       },\n       {\n          \"Effect\": \"Allow\",\n          \"Action\": [\n              \"es:ESHttpGet\"\n          ],\n          \"Resource\": [\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_all/_settings\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_cluster/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/index-name*/_mapping/type-name\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes/*/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/index-name*/_stats\"\n          ]\n       },        \n       {\n          \"Effect\": \"Allow\",\n          \"Action\": [\n              \"logs:PutLogEvents\",\n              \"logs:CreateLogStream\"\n          ],\n          \"Resource\": [\n              \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.arn}\"\n          ]\n       }\n    ]\n}\nEOF\n}\n# create kiensis data firehose delivery stream that will read from data stream and send findings to elasticsearch\nresource \"aws_kinesis_firehose_delivery_stream\" \"Cloudtrail_Logs_Firehose\" {\n  name        = \"${var.CloudTrail_To_Elastic_Name_Schema}-deliverystream\"\n  destination = \"elasticsearch\"\n  s3_configuration {\n    role_arn           = \"${aws_iam_role.Cloudtrail_Firehose_Delivery_Role.arn}\"\n    bucket_arn         = \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}\"\n    prefix             = \"cloudtrail-fails\"\n    buffer_size        = 5\n    buffer_interval    = 60\n    compression_format = \"GZIP\"\n  }\n  elasticsearch_configuration {\n    domain_arn = \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}\"\n    role_arn   = \"${aws_iam_role.Cloudtrail_Firehose_Delivery_Role.arn}\"\n    index_rotation_period = \"${var.ElasticSearch_Rotation_Period}\"\n    index_name = \"cloudtrail\"\n    type_name  = \"cloudtrail\" ## if you use 7.x elasticsearch version, do not specify this variable\n    cloudwatch_logging_options {\n        enabled         = true\n        log_group_name  = \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.name}\"\n        log_stream_name = \"cloudtrail-fails\"\n    }\n  }\n}\n# create a cloudwatch log stream for KDF to log errors to\nresource \"aws_cloudwatch_log_stream\" \"Cloudtrail_Firehose_Errors_LogStream\" {\n  name           = \"cloudtrail-fails\"\n  log_group_name = \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.name}\"\n  depends_on     = [\"aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup\"]\n}\n# create a cloudwatch subscription to send cloudtrail logs to lambda\nresource \"aws_cloudwatch_log_subscription_filter\" \"Cloudtrail_Logs_Lambda_Subscription\" {\n  name            = \"${var.CloudTrail_To_Elastic_Name_Schema}-subscription\"\n  log_group_name  = \"${aws_cloudwatch_log_group.CIS_CloudWatch_LogsGroup.name}\"\n  filter_pattern  = \"\" # leave blank for CT\n  destination_arn = \"${aws_lambda_function.Cloudtrail_Lambda_To_Firehose_Function.arn}\"\n}\n# create lambda function & execution role to send cloudtrail logs to kinesis data firehose\nresource \"aws_iam_role\" \"Cloudtrail_Lambda_To_Firehose_Role\" {\n  name = \"${var.CloudTrail_To_Elastic_Name_Schema}-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_policy\" \"Cloudtrail_Lambda_To_Firehose_Policy\" {\n  name = \"${var.CloudTrail_To_Elastic_Name_Schema}-policy\"\n  path = \"/\"\n  description = \"For ${var.CloudTrail_To_Elastic_Name_Schema} gives permission to cloudwatch and kinesis firehose - Managed by Terraform\"\n  policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\"\n      ],\n      \"Resource\": \"arn:aws:logs:*:*:*\",\n      \"Effect\": \"Allow\"\n    },\n    {\n      \"Action\": [\n        \"firehose:PutRecord\"\n      ],\n      \"Resource\": \"${aws_kinesis_firehose_delivery_stream.Cloudtrail_Logs_Firehose.arn}\",\n      \"Effect\": \"Allow\"\n    }\n  ]\n}\nEOF\n}\n\nresource \"aws_iam_role_policy_attachment\" \"Cloudtrail_Lambda_To_Firehose_Policy_Attachment\" {\n  role = \"${aws_iam_role.Cloudtrail_Lambda_To_Firehose_Role.name}\"\n  policy_arn = \"${aws_iam_policy.Cloudtrail_Lambda_To_Firehose_Policy.arn}\"\n}\nresource \"aws_lambda_function\" \"Cloudtrail_Lambda_To_Firehose_Function\" {\n  filename      = \"./cloudwatch-to-firehose.zip\"\n  description   = \"Parses CloudTrail logs from CloudWatch Log Streams and send them to Kinesis Firehose en route to Elasticsearch Service - Managed by Terraform\"\n  function_name = \"${var.CloudTrail_To_Elastic_Name_Schema}-lambda-function\"\n  role          = \"${aws_iam_role.Cloudtrail_Lambda_To_Firehose_Role.arn}\"\n  handler       = \"lambda_function.lambda_handler\"\n  runtime       = \"python3.8\"\n  timeout       = 30\n  memory_size   = 384\n  environment {\n    variables = {\n      FIREHOSE_TARGET = \"${aws_kinesis_firehose_delivery_stream.Cloudtrail_Logs_Firehose.name}\"\n    }\n  }\n  depends_on   = [\"aws_iam_role_policy_attachment.Cloudtrail_Lambda_To_Firehose_Policy_Attachment\",\"aws_kinesis_firehose_delivery_stream.Cloudtrail_Logs_Firehose\"]\n}\n# give permissions for cloudwatch logs to invoke lambda\nresource \"aws_lambda_permission\" \"Cloudtrail_Logs_Lambda_Permission\" {\n  statement_id  = \"AllowExecutionFromCloudWatchLogs\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = \"${aws_lambda_function.Cloudtrail_Lambda_To_Firehose_Function.function_name}\"\n  principal     = \"logs.amazonaws.com\"\n}\n#################\n# VPC FLOW LOGS #\n#################\nresource \"aws_iam_role\" \"VPCFlowLogs_Firehose_Delivery_Role\" {\n  name = \"${var.VPCFlowLogs_To_Elastic_Name_Schema}-firehose-siem-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"firehose.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"sts:ExternalId\":\"${data.aws_caller_identity.current.account_id}\"\n        }\n      }\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"VPCFlowLogs_Firehose_Delivery_Policy\" {\n  name   = \"${var.VPCFlowLogs_To_Elastic_Name_Schema}-firehose-siem-policy\"\n  role   = \"${aws_iam_role.VPCFlowLogs_Firehose_Delivery_Role.id}\"\n  policy = <<EOF\n{\n    \"Version\": \"2012-10-17\",  \n    \"Statement\": [    \n        {      \n            \"Effect\": \"Allow\",      \n            \"Action\": [        \n                \"s3:AbortMultipartUpload\",        \n                \"s3:GetBucketLocation\",        \n                \"s3:GetObject\",        \n                \"s3:ListBucket\",        \n                \"s3:ListBucketMultipartUploads\",\n                \"s3:HeadBucket\",       \n                \"s3:PutObject\"\n            ],      \n            \"Resource\": [        \n                \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}\",\n                \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}/*\"\t\t    \n            ]    \n        },\n        {\n           \"Effect\": \"Allow\",\n           \"Action\": [\n               \"kms:Decrypt\",\n               \"kms:GenerateDataKey\"\n           ],\n           \"Resource\": [\n               \"*\"           \n           ]\n        },\n        {\n           \"Effect\": \"Allow\",\n           \"Action\": [\n               \"es:DescribeElasticsearchDomain\",\n               \"es:DescribeElasticsearchDomains\",\n               \"es:DescribeElasticsearchDomainConfig\",\n               \"es:ESHttpPost\",\n               \"es:ESHttpPut\"\n           ],\n          \"Resource\": [\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/*\"\n          ]\n       },\n       {\n          \"Effect\": \"Allow\",\n          \"Action\": [\n              \"es:ESHttpGet\"\n          ],\n          \"Resource\": [\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_all/_settings\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_cluster/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/index-name*/_mapping/type-name\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes/*/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/index-name*/_stats\"\n          ]\n       },        \n       {\n          \"Effect\": \"Allow\",\n          \"Action\": [\n              \"logs:PutLogEvents\",\n              \"logs:CreateLogStream\"\n          ],\n          \"Resource\": [\n              \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.arn}\"\n          ]\n       }\n    ]\n}\nEOF\n}\n# create kiensis data firehose delivery stream that will read from data stream and send findings to elasticsearch\nresource \"aws_kinesis_firehose_delivery_stream\" \"VPCFlowLogs_Logs_Firehose\" {\n  name        = \"${var.VPCFlowLogs_To_Elastic_Name_Schema}-deliverystream\"\n  destination = \"elasticsearch\"\n  s3_configuration {\n    role_arn           = \"${aws_iam_role.VPCFlowLogs_Firehose_Delivery_Role.arn}\"\n    bucket_arn         = \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}\"\n    prefix             = \"vpcflowlogs-fails\"\n    buffer_size        = 5\n    buffer_interval    = 60\n    compression_format = \"GZIP\"\n  }\n  elasticsearch_configuration {\n    domain_arn = \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}\"\n    role_arn   = \"${aws_iam_role.VPCFlowLogs_Firehose_Delivery_Role.arn}\"\n    index_rotation_period = \"${var.ElasticSearch_Rotation_Period}\"\n    index_name = \"vpcflowlogs\"\n    type_name  = \"vpcflowlogs\" ## if you use 7.x elasticsearch version, do not specify this variable\n    cloudwatch_logging_options {\n        enabled         = true\n        log_group_name  = \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.name}\"\n        log_stream_name = \"vpcflowlogs-fails\"\n    }\n  }\n}\n# create a cloudwatch log stream for KDF to log errors to\nresource \"aws_cloudwatch_log_stream\" \"VPCFlowLogs_Firehose_Errors_LogStream\" {\n  name           = \"vpcflowlogs-fails\"\n  log_group_name = \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.name}\"\n  depends_on     = [\"aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup\"]\n}\n# create a cloudwatch subscription to send cloudtrail logs to lambda\nresource \"aws_cloudwatch_log_subscription_filter\" \"VPCFlowLogs_Logs_Lambda_Subscription\" {\n  name            = \"${var.VPCFlowLogs_To_Elastic_Name_Schema}-subscription\"\n  log_group_name  = \"${aws_cloudwatch_log_group.CIS_FlowLogs_CWL_Group.name}\"\n  filter_pattern  = \"[version, account_id, interface_id, srcaddr != \\\"-\\\", dstaddr != \\\"-\\\", srcport != \\\"-\\\", dstport != \\\"-\\\", protocol, packets, bytes, start, end, action, log_status]\" # leave blank for CT\n  destination_arn = \"${aws_lambda_function.VPCFlowLogs_Lambda_To_Firehose_Function.arn}\"\n}\n# create lambda function & execution role to send cloudtrail logs to kinesis data firehose\nresource \"aws_iam_role\" \"VPCFlowLogs_Lambda_To_Firehose_Role\" {\n  name = \"${var.VPCFlowLogs_To_Elastic_Name_Schema}-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_policy\" \"VPCFlowLogs_Lambda_To_Firehose_Policy\" {\n  name = \"${var.VPCFlowLogs_To_Elastic_Name_Schema}-policy\"\n  path = \"/\"\n  description = \"For ${var.VPCFlowLogs_To_Elastic_Name_Schema} gives permission to cloudwatch and kinesis firehose - Managed by Terraform\"\n  policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": [\n        \"logs:CreateLogGroup\",\n        \"logs:CreateLogStream\",\n        \"logs:PutLogEvents\"\n      ],\n      \"Resource\": \"arn:aws:logs:*:*:*\",\n      \"Effect\": \"Allow\"\n    },\n    {\n      \"Action\": [\n        \"firehose:PutRecord\"\n      ],\n      \"Resource\": \"${aws_kinesis_firehose_delivery_stream.VPCFlowLogs_Logs_Firehose.arn}\",\n      \"Effect\": \"Allow\"\n    }\n  ]\n}\nEOF\n}\n\nresource \"aws_iam_role_policy_attachment\" \"VPCFlowLogs_Lambda_To_Firehose_Policy_Attachment\" {\n  role = \"${aws_iam_role.VPCFlowLogs_Lambda_To_Firehose_Role.name}\"\n  policy_arn = \"${aws_iam_policy.VPCFlowLogs_Lambda_To_Firehose_Policy.arn}\"\n}\nresource \"aws_lambda_function\" \"VPCFlowLogs_Lambda_To_Firehose_Function\" {\n  filename      = \"./cloudwatch-to-firehose.zip\"\n  description   = \"Parses VPC Flow logs from CloudWatch Log Streams and send them to Kinesis Firehose en route to Elasticsearch Service - Managed by Terraform\"\n  function_name = \"${var.VPCFlowLogs_To_Elastic_Name_Schema}-lambda-function\"\n  role          = \"${aws_iam_role.VPCFlowLogs_Lambda_To_Firehose_Role.arn}\"\n  handler       = \"lambda_function.lambda_handler\"\n  runtime       = \"python3.8\"\n  timeout       = 30\n  memory_size   = 384\n  environment {\n    variables = {\n      FIREHOSE_TARGET = \"${aws_kinesis_firehose_delivery_stream.VPCFlowLogs_Logs_Firehose.name}\"\n    }\n  }\n  depends_on   = [\"aws_iam_role_policy_attachment.VPCFlowLogs_Lambda_To_Firehose_Policy_Attachment\",\"aws_kinesis_firehose_delivery_stream.VPCFlowLogs_Logs_Firehose\"]\n}\n# give permissions for cloudwatch logs to invoke lambda\nresource \"aws_lambda_permission\" \"VPCFlowLogs_Logs_Lambda_Permission\" {\n  statement_id  = \"AllowExecutionFromCloudWatchLogs\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = \"${aws_lambda_function.VPCFlowLogs_Lambda_To_Firehose_Function.function_name}\"\n  principal     = \"logs.amazonaws.com\"\n}\n",
    "aws-security-hub-boostrap-and-operationalization/provider.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nprovider \"aws\" {\n  region     = \"${var.AWS_REGION}\"\n}",
    "aws-security-hub-boostrap-and-operationalization/security_hub_siem.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n# Create ES Domain with Cognito user pool\n# Not all instances support encryption at rest & node-to-node encryption\nresource \"aws_elasticsearch_domain\" \"Security_Hub_Elasticsearch_Service\" {\n  domain_name           = \"${var.ElasticSearch_Domain_Name}\"\n  elasticsearch_version = \"${var.ElasticSearch_Domain_ES_Version}\"\n  cluster_config {\n    instance_type       = \"${var.ElasticSearch_Domain_Instance_Type}\"\n    instance_count      = \"${var.ElasticSearch_Domain_Instance_Count}\"    \n  }\n  ebs_options {\n      ebs_enabled  = true\n      volume_type  = \"gp2\"\n      volume_size  = \"15\"\n  }\n  encrypt_at_rest {\n      enabled = true\n  }\n  node_to_node_encryption {\n      enabled = true\n  }\n  snapshot_options {\n    automated_snapshot_start_hour = 23\n  }\n  cognito_options {\n      enabled          = true\n      user_pool_id     = \"${aws_cognito_user_pool.ES_Cognito_User_Pool.id}\"\n      identity_pool_id = \"${aws_cognito_identity_pool.ES_Cognito_Identity_Pool.id}\"\n      role_arn         = \"${aws_iam_role.ES_Cognito_Role.arn}\"\n  }\n  depends_on           = [\"aws_securityhub_account.Security_Hub_Enabled\"]\n}\n# this elasticsearch access policy will only allow your account and the IP your specify to access it\nresource \"aws_elasticsearch_domain_policy\" \"Security_Hub_Elasticsearch_Service_Policy\" {\n  domain_name = \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.domain_name}\"\n  access_policies = <<POLICIES\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"AWS\": \"*\"\n      },\n      \"Action\": \"es:*\",\n      \"Resource\": \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/*\",\n      \"Condition\": {\n        \"IpAddress\": {\n          \"aws:SourceIp\": \"${var.TRUSTED_IP}\"\n        }\n      }\n    }\n  ]\n}\nPOLICIES\n}\n# Create cognito user pool with schema and password policy\nresource \"aws_cognito_user_pool\" \"ES_Cognito_User_Pool\" {\n  name                       = \"${var.ES_Cognito_User_Pool_Name}\"\n  email_verification_subject = \"${var.ElasticSearch_Domain_Name} Kibana Device Verification Code\"\n  email_verification_message = \"Please use the following code {####}\"\n  alias_attributes           = [\"email\", \"preferred_username\"]\n  auto_verified_attributes   = [\"email\"]\n  admin_create_user_config {\n    allow_admin_create_user_only = false\n  }\n  password_policy {\n      minimum_length    = 14\n      require_lowercase = true\n      require_numbers   = true\n      require_symbols   = true\n      require_uppercase = true\n  }\n  schema {\n    attribute_data_type      = \"String\"\n    developer_only_attribute = false\n    mutable                  = false\n    name                     = \"email\"\n    required                 = true\n    string_attribute_constraints {\n      min_length = 7\n      max_length = 64\n    }\n  }\n}\n# create user pool domain\nresource \"aws_cognito_user_pool_domain\" \"ES_Cognito_User_Pool_Domain\" {\n  domain       = \"${var.ES_Cognito_User_Pool_Domain_Name}\"\n  user_pool_id = \"${aws_cognito_user_pool.ES_Cognito_User_Pool.id}\"\n}\n# create identity pool for Cognito\nresource \"aws_cognito_identity_pool\" \"ES_Cognito_Identity_Pool\" {\n  identity_pool_name               = \"${var.ES_Cognito_Identity_Pool_Name}\"\n  allow_unauthenticated_identities = true # MUST BE TRUE FOR KIBANA TO USE THIS\n  lifecycle {\n    ignore_changes                 = [\"*\"]\n  }\n}\n# create unauth & auth IAM roles for Cognito\nresource \"aws_iam_role\" \"ES_Identity_Pool_Authenticated_Role\" {\n  name = \"${var.ES_Cognito_Identity_Pool_Name}-authenticated-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Federated\": \"cognito-identity.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"cognito-identity.amazonaws.com:aud\": \"${aws_cognito_identity_pool.ES_Cognito_Identity_Pool.id}\"\n        },\n        \"ForAnyValue:StringLike\": {\n          \"cognito-identity.amazonaws.com:amr\": \"authenticated\"\n        }\n      }\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"ES_Identity_Pool_Authenticated_Policy\" {\n  name = \"${var.ES_Cognito_Identity_Pool_Name}-authenticated-policy\"\n  role = \"${aws_iam_role.ES_Identity_Pool_Authenticated_Role.id}\"\n  policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Action\": [\n        \"es:ESHttp*\",\n        \"mobileanalytics:PutEvents\",\n        \"cognito-sync:*\",\n        \"cognito-identity:*\"\n      ],\n      \"Resource\": [\n        \"*\"\n      ]\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role\" \"ES_Identity_Pool_Unauthenticated_Role\" {\n  name               = \"${var.ES_Cognito_Identity_Pool_Name}-unauthenticated-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Federated\": \"cognito-identity.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRoleWithWebIdentity\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"cognito-identity.amazonaws.com:aud\": \"${aws_cognito_identity_pool.ES_Cognito_Identity_Pool.id}\"\n        },\n        \"ForAnyValue:StringLike\": {\n          \"cognito-identity.amazonaws.com:amr\": \"unauthenticated\"\n        }\n      }\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"ES_Identity_Pool_Unauthenticated_Policy\" {\n  name   = \"${var.ES_Cognito_Identity_Pool_Name}-unauthenticated-policy\"\n  role   = \"${aws_iam_role.ES_Identity_Pool_Unauthenticated_Role.id}\"\n  policy = <<EOF\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"mobileanalytics:PutEvents\",\n                \"cognito-sync:*\"\n            ],\n            \"Resource\": [\n                \"*\"\n            ]\n        }\n    ]\n}\nEOF\n}\nresource \"aws_cognito_identity_pool_roles_attachment\" \"ES_ID_Pool_Role_Attachment\" {\n  identity_pool_id    = \"${aws_cognito_identity_pool.ES_Cognito_Identity_Pool.id}\"\n  roles = {\n    \"authenticated\"   = \"${aws_iam_role.ES_Identity_Pool_Authenticated_Role.arn}\"\n    \"unauthenticated\" = \"${aws_iam_role.ES_Identity_Pool_Unauthenticated_Role.arn}\"\n  }\n}\nresource \"aws_iam_role\" \"ES_Cognito_Role\" {\n  name               = \"${var.ElasticSearch_Domain_Name}-cognito-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"es.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"ES_Cognito_Policy\" {\n  name   = \"${var.ElasticSearch_Domain_Name}-cognito-policy\"\n  role   = \"${aws_iam_role.ES_Cognito_Role.id}\"\n  policy = <<EOF\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"cognito-idp:DescribeUserPool\",\n                \"cognito-idp:CreateUserPoolClient\",\n                \"cognito-idp:DeleteUserPoolClient\",\n                \"cognito-idp:DescribeUserPoolClient\",\n                \"cognito-idp:AdminInitiateAuth\",\n                \"cognito-idp:AdminUserGlobalSignOut\",\n                \"cognito-idp:ListUserPoolClients\",\n                \"cognito-identity:DescribeIdentityPool\",\n                \"cognito-identity:UpdateIdentityPool\",\n                \"cognito-identity:SetIdentityPoolRoles\",\n                \"cognito-identity:GetIdentityPoolRoles\"\n            ],\n            \"Resource\": \"*\"\n        },\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": \"iam:PassRole\",\n            \"Resource\": \"*\",\n            \"Condition\": {\n                \"StringEqualsIfExists\": {\n                    \"iam:PassedToService\": \"cognito-identity.amazonaws.com\"\n                }\n            }\n        }\n    ]\n}\nEOF\n}\n# create cloudwatch event iam role to invoke kinesis data streams\nresource \"aws_iam_role\" \"CWE_Kinesis_Role\" {\n  name               = \"security-hub-to-elasticsearch-event-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"events.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\"\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"CWE_Kinesis_Policy\" {\n  name   = \"security-hub-to-elasticsearch-event-policy\"\n  role   = \"${aws_iam_role.CWE_Kinesis_Role.id}\"\n  policy = <<EOF\n{\n    \"Version\": \"2012-10-17\",\n    \"Statement\": [\n        {\n            \"Effect\": \"Allow\",\n            \"Action\": [\n                \"kinesis:PutRecord\",\n                \"kinesis:PutRecords\"\n            ],\n            \"Resource\": [\n                \"${aws_kinesis_stream.Security_Hub_Kinesis_Stream.arn}\"\n            ]\n        }\n    ]\n}\nEOF\n}\n# create cloudwatch event that will export all findings from security hub\nresource \"aws_cloudwatch_event_rule\" \"Security_Hub_To_Elastic\" {\n  name          = \"security-hub-to-elasticsearch\"\n  description   = \"Sends all Security Hub findings to Elasticsearch Service\"\n  role_arn      = \"${aws_iam_role.CWE_Kinesis_Role.arn}\"\n  event_pattern = <<PATTERN\n{\n  \"source\": [\n    \"aws.securityhub\"\n  ],\n  \"detail-type\": [\n    \"Security Hub Findings - Imported\"\n  ]\n}\nPATTERN\n}\n# create a cloudwatch event target that will send all security hub findings to a kinesis data stream\nresource \"aws_cloudwatch_event_target\" \"CWE_KinesisDataStream_Target\" {\n  rule      = \"${aws_cloudwatch_event_rule.Security_Hub_To_Elastic.name}\"\n  target_id = \"SendToKDS\"\n  arn       = \"${aws_kinesis_stream.Security_Hub_Kinesis_Stream.arn}\"\n}\n# create kinesis data stream to write security hub findings to firehose delivery stream\nresource \"aws_kinesis_stream\" \"Security_Hub_Kinesis_Stream\" {\n  name                      = \"securityhub-kinesis-stream\"\n  shard_count               = 5\n  retention_period          = 24\n  enforce_consumer_deletion = true\n  encryption_type           = \"KMS\"\n  kms_key_id                = \"alias/aws/kinesis\"\n}\n# create an s3 bucket to receive failed records from kinesis data firehose\nresource \"aws_s3_bucket\" \"Kinesis_Failed_Logs_Bucket\" {\n  bucket_prefix = \"${var.KDF_Bucket_Prefix}\"\n  acl           = \"private\"\n  versioning {\n    enabled = true\n  }\n  server_side_encryption_configuration {\n    rule {\n      apply_server_side_encryption_by_default {\n        sse_algorithm     = \"AES256\"\n      }\n    }\n  }\n  lifecycle_rule {\n    enabled = true\n    expiration {\n      days = 365\n    }\n    noncurrent_version_expiration {\n      days = 365\n    }\n  }\n}\n# create an IAM role and policy that allows kinesis data firehose to interact with\n# elasticsearch and kinesis data streams\nresource \"aws_iam_role\" \"Firehose_Delivery_Role\" {\n  name = \"securityhub-firehose-siem-role\"\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\n        \"Service\": \"firehose.amazonaws.com\"\n      },\n      \"Action\": \"sts:AssumeRole\",\n      \"Condition\": {\n        \"StringEquals\": {\n          \"sts:ExternalId\":\"${data.aws_caller_identity.current.account_id}\"\n        }\n      }\n    }\n  ]\n}\nEOF\n}\nresource \"aws_iam_role_policy\" \"Firehose_Delivery_Policy\" {\n  name   = \"securityhub-firehose-siem-policy\"\n  role   = \"${aws_iam_role.Firehose_Delivery_Role.id}\"\n  policy = <<EOF\n{\n    \"Version\": \"2012-10-17\",  \n    \"Statement\": [    \n        {      \n            \"Effect\": \"Allow\",      \n            \"Action\": [        \n                \"s3:AbortMultipartUpload\",        \n                \"s3:GetBucketLocation\",        \n                \"s3:GetObject\",\n                \"s3:HeadBucket\",        \n                \"s3:ListBucket\",        \n                \"s3:ListBucketMultipartUploads\",        \n                \"s3:PutObject\"\n            ],      \n            \"Resource\": [        \n                \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}\",\n                \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}/*\"\t\t    \n            ]    \n        },\n        {\n           \"Effect\": \"Allow\",\n           \"Action\": [\n               \"kms:Decrypt\",\n               \"kms:GenerateDataKey\"\n           ],\n           \"Resource\": [\n               \"*\"           \n           ]\n        },\n        {\n           \"Effect\": \"Allow\",\n           \"Action\": [\n               \"es:DescribeElasticsearchDomain\",\n               \"es:DescribeElasticsearchDomains\",\n               \"es:DescribeElasticsearchDomainConfig\",\n               \"es:ESHttpPost\",\n               \"es:ESHttpPut\"\n           ],\n          \"Resource\": [\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/*\"\n          ]\n       },\n       {\n          \"Effect\": \"Allow\",\n          \"Action\": [\n              \"es:ESHttpGet\"\n          ],\n          \"Resource\": [\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_all/_settings\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_cluster/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/index-name*/_mapping/type-name\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_nodes/*/stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/_stats\",\n              \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}/index-name*/_stats\"\n          ]\n       },        \n       {\n          \"Effect\": \"Allow\",\n          \"Action\": [\n              \"kinesis:DescribeStream\",\n              \"kinesis:GetShardIterator\",\n              \"kinesis:GetRecords\"\n          ],\n          \"Resource\": \"${aws_kinesis_stream.Security_Hub_Kinesis_Stream.arn}\"\n       },\n       {\n          \"Effect\": \"Allow\",\n          \"Action\": [\n              \"logs:PutLogEvents\",\n              \"logs:CreateLogGroup\",\n              \"logs:CreateLogStream\"\n          ],\n          \"Resource\": [\n              \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.arn}*\"\n          ]\n       }\n    ]\n}\nEOF\n}\n# create kiensis data firehose delivery stream that will read from data stream and send findings to elasticsearch\n# will also create an additional cloudwatch log group and log stream for firehose to write error logs to\nresource \"aws_kinesis_firehose_delivery_stream\" \"Security_Hub_SIEM_KDF\" {\n  name        = \"securityhub-siem-deliverystream\"\n  destination = \"elasticsearch\"\n  kinesis_source_configuration {\n      kinesis_stream_arn = \"${aws_kinesis_stream.Security_Hub_Kinesis_Stream.arn}\"\n      role_arn           = \"${aws_iam_role.Firehose_Delivery_Role.arn}\"\n    }\n  s3_configuration {\n    role_arn           = \"${aws_iam_role.Firehose_Delivery_Role.arn}\"\n    bucket_arn         = \"${aws_s3_bucket.Kinesis_Failed_Logs_Bucket.arn}\"\n    buffer_size        = 5\n    buffer_interval    = 60\n    compression_format = \"GZIP\"\n  }\n  elasticsearch_configuration {\n    domain_arn            = \"${aws_elasticsearch_domain.Security_Hub_Elasticsearch_Service.arn}\"\n    role_arn              = \"${aws_iam_role.Firehose_Delivery_Role.arn}\"\n    index_rotation_period = \"${var.ElasticSearch_Rotation_Period}\"\n    index_name            = \"securityhub-findings\"\n    type_name             = \"ASFF\" ## if you use 7.x elasticsearch version, do not specify this variable\n    cloudwatch_logging_options {\n        enabled         = true\n        log_group_name  = \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.name}\"\n        log_stream_name = \"sechub-log-fails\"\n    }\n  }\n  depends_on = [\"aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup\"]\n}\nresource \"aws_cloudwatch_log_group\" \"Kinesis_Firehose_Errors_LogsGroup\" {\n  name = \"Firehose/errors\"\n}\nresource \"aws_cloudwatch_log_stream\" \"Kinesis_Firehose_Errors_LogStream\" {\n  name           = \"sechub-log-fails\"\n  log_group_name = \"${aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup.name}\"\n  depends_on     = [\"aws_cloudwatch_log_group.Kinesis_Firehose_Errors_LogsGroup\"]\n}",
    "aws-security-hub-boostrap-and-operationalization/security_services.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n# Enable GuardDuty\nresource \"aws_guardduty_detector\" \"GuardDuty_Detector\" {\n  enable                       = true\n  finding_publishing_frequency = \"${var.GuardDuty_Finding_Publishing_Frequency}\"\n  depends_on                   = [\"aws_securityhub_account.Security_Hub_Enabled\"]\n}\n# Enable Security Hub\nresource \"aws_securityhub_account\" \"Security_Hub_Enabled\" {\n  depends_on = [\"aws_config_configuration_recorder_status.Config_Recorder_Enabled\"]\n}\n# Enable CIS standard\nresource \"aws_securityhub_standards_subscription\" \"Security_Hub_CIS_Standard_Subscription\" {\n  depends_on    = [\"aws_securityhub_account.Security_Hub_Enabled\"]\n  standards_arn = \"arn:aws:securityhub:::ruleset/cis-aws-foundations-benchmark/v/1.2.0\"\n}\n# Enable PCI-DSS standard\nresource \"aws_securityhub_standards_subscription\" \"Security_Hub_PCIDSS_Standard_Subscription\" {\n  depends_on    = [\"aws_securityhub_account.Security_Hub_Enabled\"]\n  standards_arn = \"arn:aws:securityhub:${var.AWS_REGION}::standards/pci-dss/v/3.2.1\"\n}\n# create IAM access analyzer\nresource \"aws_accessanalyzer_analyzer\" \"IAA\" {\n  analyzer_name = \"terraformanalyzer\"\n  depends_on    = [\"aws_securityhub_account.Security_Hub_Enabled\"]\n}\n# Create Inspector assessment that targets all Instances \nresource \"aws_inspector_assessment_target\" \"Inspector_Assessment_Target_All\" {\n  name = \"target-all-instances\"\n}\n# Change rule package Variables dependent on location\nresource \"aws_inspector_assessment_template\" \"Inspector_Assessment_Template\" {\n  name               = \"all-assessments-template\"\n  duration           = 3600\n  target_arn         = \"${aws_inspector_assessment_target.Inspector_Assessment_Target_All.arn}\"\n  rules_package_arns = \"${var.Inspector_Assessment_Rules_Packages_APSoutheast2}\"\n}",
    "aws-security-hub-boostrap-and-operationalization/variables.tf": " # Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n # SPDX-License-Identifier: MIT-0\n #\n # Permission is hereby granted, free of charge, to any person obtaining a copy of this\n # software and associated documentation files (the \"Software\"), to deal in the Software\n # without restriction, including without limitation the rights to use, copy, modify,\n # merge, publish, distribute, sublicense, and/or sell copies of the Software, and to\n # permit persons to whom the Software is furnished to do so.\n #\n # THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED,\n # INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A\n # PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\n # HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION\n # OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE\n # SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n######################\n# GLOBAL variables\n######################\nvariable \"AWS_REGION\" {\n  default = \"us-east-1\"\n}\nvariable \"TRUSTED_IP\" {\n  description = \"Used to populate Elasticsearch SourceIP condition and VPC SSH security group\"\n  default     = \"/32\"\n}\n######################\n# config.tf variables\n######################\nvariable \"Config_Bucket_Prefix\" {\n  default = \"config-bucket\"\n}\nvariable \"Config_Delivery_Frequency\" {\n  default = \"One_Hour\"\n}\n#################################\n# security_services.tf variables\n#################################\nvariable \"GuardDuty_Finding_Publishing_Frequency\" {\n  default = \"FIFTEEN_MINUTES\"\n}\n# US East (N. Virginia)\nvariable \"Inspector_Assessment_Rules_Packages_USEast1\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:us-east-1:316112463485:rulespackage/0-gEjTy7T7\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:us-east-1:316112463485:rulespackage/0-rExsr2X8\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:us-east-1:316112463485:rulespackage/0-R01qwB5Q\", // AWS Security Best Practices\n   \"arn:aws:inspector:us-east-1:316112463485:rulespackage/0-PmNV0Tcd\", // Network Reachability\n   ]\n}\n# US East (Ohio)\nvariable \"Inspector_Assessment_Rules_Packages_USEast2\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:us-east-2:646659390643:rulespackage/0-JnA8Zp85\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:us-east-2:646659390643:rulespackage/0-m8r61nnh\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:us-east-2:646659390643:rulespackage/0-AxKmMHPX\", // AWS Security Best Practices\n   \"arn:aws:inspector:us-east-2:646659390643:rulespackage/0-cE4kTR30\", // Network Reachability\n   ]\n}\n# US West (N. California)\nvariable \"Inspector_Assessment_Rules_Packages_USWest1\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:us-west-1:166987590008:rulespackage/0-TKgzoVOa\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:us-west-1:166987590008:rulespackage/0-xUY8iRqX\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:us-west-1:166987590008:rulespackage/0-TxmXimXF\", // AWS Security Best Practices\n   \"arn:aws:inspector:us-west-1:166987590008:rulespackage/0-byoQRFYm\", // Network Reachability\n  ]\n}\n# US West (Oregon)\nvariable \"Inspector_Assessment_Rules_Packages_USWest2\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-9hgA516p\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-H5hpSawc\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-JJOtZiqQ\", // AWS Security Best Practices\n   \"arn:aws:inspector:us-west-2:758058086616:rulespackage/0-rD1z6dpl\", // Network Reachability\n   ]\n}\n# Asia Pacific (Mumbai)\nvariable \"Inspector_Assessment_Rules_Packages_APSouth1\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:ap-south-1:162588757376:rulespackage/0-LqnJE9dO\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:ap-south-1:162588757376:rulespackage/0-PSUlX14m\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:ap-south-1:162588757376:rulespackage/0-fs0IZZBj\", // AWS Security Best Practices\n   \"arn:aws:inspector:ap-south-1:162588757376:rulespackage/0-YxKfjFu1\", // Network Reachability\n  ]\n}\n# Asia Pacific (Seoul)\nvariable \"Inspector_Assessment_Rules_Packages_APNortheast2\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:ap-northeast-2:526946625049:rulespackage/0-PoGHMznc\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:ap-northeast-2:526946625049:rulespackage/0-T9srhg1z\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:ap-northeast-2:526946625049:rulespackage/0-2WRpmi4n\", // AWS Security Best Practices\n   \"arn:aws:inspector:ap-northeast-2:526946625049:rulespackage/0-s3OmLzhL\", // Network Reachability\n  ]\n}\n# Asia Pacific (Sydney)\n\nvariable \"Inspector_Assessment_Rules_Packages_APSoutheast2\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:ap-southeast-2:454640832652:rulespackage/0-D5TGAxiR\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:ap-southeast-2:454640832652:rulespackage/0-Vkd2Vxjq\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:ap-southeast-2:454640832652:rulespackage/0-asL6HRgN\", // AWS Security Best Practices\n   \"arn:aws:inspector:ap-southeast-2:454640832652:rulespackage/0-FLcuV4Gz\", // Network Reachability\n  ]\n}\n# Asia Pacific (Tokyo)\nvariable \"Inspector_Assessment_Rules_Packages_APNortheast1\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:ap-northeast-1:406045910587:rulespackage/0-gHP9oWNT\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:ap-northeast-1:406045910587:rulespackage/0-7WNjqgGu\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:ap-northeast-1:406045910587:rulespackage/0-bBUQnxMq\", // AWS Security Best Practices\n   \"arn:aws:inspector:ap-northeast-1:406045910587:rulespackage/0-YI95DVd7\", // Network Reachability\n  ]\n}\n# Europe (Frankfurt)\nvariable \"Inspector_Assessment_Rules_Packages_EUCentral1\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:eu-central-1:537503971621:rulespackage/0-wNqHa8M9\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:eu-central-1:537503971621:rulespackage/0-nZrAVuv8\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:eu-central-1:537503971621:rulespackage/0-ZujVHEPB\", // AWS Security Best Practices\n   \"arn:aws:inspector:eu-central-1:537503971621:rulespackage/0-6yunpJ91\", // Network Reachability\n  ]\n}\n# Europe (Ireland)\nvariable \"Inspector_Assessment_Rules_Packages_EUWest1\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:eu-west-1:357557129151:rulespackage/0-ubA5XvBh\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:eu-west-1:357557129151:rulespackage/0-sJBhCr0F\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:eu-west-1:357557129151:rulespackage/0-SnojL3Z6\", // AWS Security Best Practices\n   \"arn:aws:inspector:eu-west-1:357557129151:rulespackage/0-SPzU33xe\", // Network Reachability\n  ]\n}\n# Europe (London)\nvariable \"Inspector_Assessment_Rules_Packages_EUWest2\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:eu-west-2:146838936955:rulespackage/0-kZGCqcE1\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:eu-west-2:146838936955:rulespackage/0-IeCjwf1W\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:eu-west-2:146838936955:rulespackage/0-XApUiSaP\", // AWS Security Best Practices\n   \"arn:aws:inspector:eu-west-2:146838936955:rulespackage/0-AizSYyNq\", // Network Reachability\n  ]\n}\n# Europe (Stockholm)\nvariable \"Inspector_Assessment_Rules_Packages_EUNorth1\" {\n  type        = \"list\"\n  description = \"All Inspector Assessment Rules for Target All Group\"\n  default = [\n   \"arn:aws:inspector:eu-north-1:453420244670:rulespackage/0-IgdgIewd\", // NIST Common Vulnerability & Exposures (CVEs)\n   \"arn:aws:inspector:eu-north-1:453420244670:rulespackage/0-Yn8jlX7f\", // CIS OS Security Configuration Benchmark\n   \"arn:aws:inspector:eu-north-1:453420244670:rulespackage/0-HfBQSbSf\", // AWS Security Best Practices\n   \"arn:aws:inspector:eu-north-1:453420244670:rulespackage/0-52Sn74uu\", // Network Reachability\n  ]\n}\n#################################\n# security_hub_siem.tf variables\n#################################\nvariable \"ES_Cognito_User_Pool_Name\" {\n  default = \"elastic-kibanausers\"\n}\nvariable \"ES_Cognito_User_Pool_Domain_Name\" {\n  default = \"\"\n}\nvariable \"ES_Cognito_Identity_Pool_Name\" {\n  default = \"elastickibanaidp\"\n}\nvariable \"ElasticSearch_Domain_Name\" {\n  default = \"securityhub-siem\"\n}\nvariable \"ElasticSearch_Domain_ES_Version\" {\n  default = \"6.8\"\n}\nvariable \"ElasticSearch_Domain_Instance_Type\" {\n  default = \"c4.large.elasticsearch\"\n}\nvariable \"ElasticSearch_Domain_Instance_Count\" {\n  default = \"1\"\n}\nvariable \"KDF_Bucket_Prefix\" {\n  default = \"elastic-kdf-logs-bucket\"\n}\nvariable \"ElasticSearch_Rotation_Period\" {\n  default = \"OneMonth\"\n}\n###########################################\n# cis_baseline_infrastructure.tf variables\n###########################################\nvariable \"AccessLog_Bucket_Prefix\" {\n  default = \"cis-accesslogs-bucket\"\n}\nvariable \"CIS_CloudTrail_Trail_Name\" {\n  default = \"cis-cloudtrail\"\n}\nvariable \"CloudTrail_Bucket_Prefix\" {\n  default = \"cis-cloudtrail-logs-bucket\"\n}\nvariable \"Network_Resource_Count\" {\n  default     = 1\n  description = \"Amount of Network Resources Provisioned e.g. Subnets and Route Tables - Adjust for Regional AZ Count\"\n}\nvariable \"CIS_VPC_CIDR\" {\n  default = \"10.100.0.0/16\"\n}\nvariable \"CIS_VPC_Name_Tag\" {\n  default = \"CIS_VPC\"\n}\n#######################\n# cis_3-x.tf variables\n#######################\nvariable \"CIS_SNS_Prefix\" {\n  default = \"cis-3x-alarms\"\n}\nvariable \"CIS_Metric_Alarm_Namespace\" {\n  default = \"LogMetrics\"\n}\n############################################\n# elasticsearch_siem_extension.tf variables \n############################################\nvariable \"CloudTrail_To_Elastic_Name_Schema\" {\n  default = \"cloudtrail-to-elastic\"\n}\nvariable \"VPCFlowLogs_To_Elastic_Name_Schema\" {\n  default = \"vpc-flowlogs-to-elastic\"\n}"
  }
}