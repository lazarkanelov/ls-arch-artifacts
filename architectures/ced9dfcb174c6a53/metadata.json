{
  "hash": "ced9dfcb174c6a53",
  "source_url": "https://github.com/aws-samples/serverless-patterns/tree/main/s3-lambda-terraform",
  "source_type": "github_repos",
  "discovered_at": "2026-01-11T08:20:42.768302",
  "services": [
    "iam",
    "lambda",
    "s3"
  ],
  "resource_count": 5,
  "name": "aws-samples/serverless-patterns/s3-lambda-terraform",
  "description": "Serverless patterns. Learn more at the website: https://serverlessland.com/patterns.",
  "version": "main",
  "skipped": false,
  "skip_reason": null,
  "original_format": null,
  "terraform_files": {
    "main.tf": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 3.27\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"3.1.0\"\n    }\n  }\n\n  required_version = \">= 0.14.9\"\n}\n\nprovider \"aws\" {\n  profile = \"default\"\n  region  = \"us-east-1\"\n}\n\nresource \"random_string\" \"random\" {\n  length  = 8\n  special = false\n  lower   = true\n  number  = true\n  upper   = false\n}\n\nresource \"aws_lambda_function\" \"lambda_s3_handler\" {\n  function_name    = \"process-s3-new-objects\"\n  filename         = data.archive_file.lambda_zip_file.output_path\n  source_code_hash = data.archive_file.lambda_zip_file.output_base64sha256\n  handler          = \"index.handler\"\n  role             = aws_iam_role.iam_for_lambda.arn\n  runtime          = \"nodejs16.x\"\n}\n\ndata \"archive_file\" \"lambda_zip_file\" {\n  type        = \"zip\"\n  source_file = \"${path.module}/src/index.js\"\n  output_path = \"${path.module}/lambda.zip\"\n}\n\nresource \"aws_iam_role\" \"iam_for_lambda\" {\n  name = \"iam_for_lambda\"\n\n  assume_role_policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Action\": \"sts:AssumeRole\",\n      \"Principal\": {\n        \"Service\": \"lambda.amazonaws.com\"\n      },\n      \"Effect\": \"Allow\",\n      \"Sid\": \"\"\n    }\n  ]\n}\nEOF\n  inline_policy {\n    name   = \"lambda_logs_policy\"\n    policy = <<EOF\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n        \"Sid\": \"AllowLambdaFunctionToCreateLogs\",\n        \"Action\": [ \n            \"logs:*\" \n        ],\n        \"Effect\": \"Allow\",\n        \"Resource\": [ \n            \"arn:aws:logs:*:*:*\" \n        ]\n    }\n  ]\n}\nEOF\n  }\n}\n\nresource \"aws_lambda_permission\" \"allow_bucket_invoke_lambda\" {\n  statement_id  = \"AllowExecutionFromS3Bucket\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.lambda_s3_handler.arn\n  principal     = \"s3.amazonaws.com\"\n  source_arn    = aws_s3_bucket.my_bucket.arn\n}\n\nresource \"aws_s3_bucket\" \"my_bucket\" {\n  bucket = \"my-bucket-${random_string.random.result}\"\n}\n\nresource \"aws_s3_bucket_notification\" \"bucket_notification\" {\n  bucket = aws_s3_bucket.my_bucket.id\n\n  lambda_function {\n    lambda_function_arn = aws_lambda_function.lambda_s3_handler.arn\n    events              = [\"s3:ObjectCreated:*\"]\n  }\n\n  depends_on = [aws_lambda_permission.allow_bucket_invoke_lambda]\n}\n\noutput \"name_of_bucket\" {\n  value       = aws_s3_bucket.my_bucket.bucket\n  description = \"The name of the bucket\"\n}\n"
  }
}