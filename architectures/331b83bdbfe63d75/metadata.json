{
  "hash": "331b83bdbfe63d75",
  "source_url": "https://github.com/aws-samples/serverless-patterns/tree/main/apigw-http-api-lambda-terraform",
  "source_type": "github_repos",
  "discovered_at": "2026-01-11T08:20:46.397004",
  "services": [
    "cloudwatch",
    "lambda",
    "apigateway",
    "iam",
    "s3"
  ],
  "resource_count": 13,
  "name": "aws-samples/serverless-patterns/apigw-http-api-lambda-terraform",
  "description": "Serverless patterns. Learn more at the website: https://serverlessland.com/patterns.",
  "version": "main",
  "skipped": false,
  "skip_reason": null,
  "original_format": null,
  "terraform_files": {
    "main.tf": "terraform {\n  required_providers {\n    aws = {\n      source  = \"hashicorp/aws\"\n      version = \"~> 4.0.0\"\n    }\n    random = {\n      source  = \"hashicorp/random\"\n      version = \"~> 3.1.0\"\n    }\n    archive = {\n      source  = \"hashicorp/archive\"\n      version = \"~> 2.2.0\"\n    }\n  }\n\n  required_version = \"~> 1.0\"\n}\n\nprovider \"aws\" {\n  profile = \"default\"\n  region = var.aws_region\n}\n\n\nresource \"aws_s3_bucket\" \"lambda_bucket\" {\n  bucket_prefix = var.s3_bucket_prefix\n  force_destroy = true\n}\n\nresource \"aws_s3_bucket_acl\" \"private_bucket\" {\n  bucket = aws_s3_bucket.lambda_bucket.id\n  acl    = \"private\"\n}\n\ndata \"archive_file\" \"lambda_zip\" {\n  type = \"zip\"\n\n  source_dir  = \"${path.module}/src\"\n  output_path = \"${path.module}/src.zip\"\n}\n\nresource \"aws_s3_object\" \"lambda_app\" {\n  bucket = aws_s3_bucket.lambda_bucket.id\n\n  key    = \"source.zip\"\n  source = data.archive_file.lambda_zip.output_path\n\n  etag = filemd5(data.archive_file.lambda_zip.output_path)\n}\n\n//Define lambda function\nresource \"aws_lambda_function\" \"app\" {\n  function_name = var.lambda_name\n  description = \"apigwy-http-api serverlessland pattern\"\n\n  s3_bucket = aws_s3_bucket.lambda_bucket.id\n  s3_key    = aws_s3_object.lambda_app.key\n\n  runtime = \"python3.14\"\n  handler = \"app.lambda_handler\"\n\n  source_code_hash = data.archive_file.lambda_zip.output_base64sha256\n\n  role = aws_iam_role.lambda_exec.arn\n  depends_on = [aws_cloudwatch_log_group.lambda_log]\n}\n\nresource \"aws_cloudwatch_log_group\" \"lambda_log\" {\n  name = \"/aws/lambda/${var.lambda_name}\"\n\n  retention_in_days = var.lambda_log_retention\n}\n\nresource \"aws_iam_role\" \"lambda_exec\" {\n  name = \"serverless_lambda\"\n\n  assume_role_policy = jsonencode({\n    Version = \"2012-10-17\"\n    Statement = [{\n      Action = \"sts:AssumeRole\"\n      Effect = \"Allow\"\n      Sid    = \"\"\n      Principal = {\n        Service = \"lambda.amazonaws.com\"\n      }\n      }\n    ]\n  })\n}\n\nresource \"aws_iam_role_policy_attachment\" \"lambda_policy\" {\n  role       = aws_iam_role.lambda_exec.name\n  policy_arn = \"arn:aws:iam::aws:policy/service-role/AWSLambdaBasicExecutionRole\"\n}\n\n// API Gateway stuff\n\nresource \"aws_apigatewayv2_api\" \"lambda\" {\n  name          = \"apigw-http-lambda\"\n  protocol_type = \"HTTP\"\n  description   = \"Serverlessland API Gwy HTTP API and AWS Lambda function\"\n\n  cors_configuration {\n      allow_credentials = false\n      allow_headers     = []\n      allow_methods     = [\n          \"GET\",\n          \"HEAD\",\n          \"OPTIONS\",\n          \"POST\",\n      ]\n      allow_origins     = [\n          \"*\",\n      ]\n      expose_headers    = []\n      max_age           = 0\n  }\n}\n\n\nresource \"aws_apigatewayv2_stage\" \"default\" {\n  api_id = aws_apigatewayv2_api.lambda.id\n\n  name        = \"$default\"\n  auto_deploy = true\n\n  access_log_settings {\n    destination_arn = aws_cloudwatch_log_group.api_gw.arn\n\n    format = jsonencode({\n      requestId               = \"$context.requestId\"\n      sourceIp                = \"$context.identity.sourceIp\"\n      requestTime             = \"$context.requestTime\"\n      protocol                = \"$context.protocol\"\n      httpMethod              = \"$context.httpMethod\"\n      resourcePath            = \"$context.resourcePath\"\n      routeKey                = \"$context.routeKey\"\n      status                  = \"$context.status\"\n      responseLength          = \"$context.responseLength\"\n      integrationErrorMessage = \"$context.integrationErrorMessage\"\n      }\n    )\n  }\n  depends_on = [aws_cloudwatch_log_group.api_gw]\n}\n\nresource \"aws_apigatewayv2_integration\" \"app\" {\n  api_id = aws_apigatewayv2_api.lambda.id\n\n  integration_uri    = aws_lambda_function.app.invoke_arn\n  integration_type   = \"AWS_PROXY\"\n}\n\nresource \"aws_apigatewayv2_route\" \"any\" {\n  api_id = aws_apigatewayv2_api.lambda.id\n  route_key = \"$default\"\n  target    = \"integrations/${aws_apigatewayv2_integration.app.id}\"\n}\n\nresource \"aws_cloudwatch_log_group\" \"api_gw\" {\n  name = \"/aws/api_gw/${aws_apigatewayv2_api.lambda.name}\"\n\n  retention_in_days = var.apigw_log_retention\n}\n\nresource \"aws_lambda_permission\" \"api_gw\" {\n  statement_id  = \"AllowExecutionFromAPIGateway\"\n  action        = \"lambda:InvokeFunction\"\n  function_name = aws_lambda_function.app.function_name\n  principal     = \"apigateway.amazonaws.com\"\n\n  source_arn = \"${aws_apigatewayv2_api.lambda.execution_arn}/*/*\"\n}",
    "outputs.tf": "# Output value definitions\n\noutput \"apigwy_url\" {\n  description = \"URL for API Gateway stage\"\n\n  value = aws_apigatewayv2_api.lambda.api_endpoint\n}\n",
    "variables.tf": "# Input variable definitions\n\nvariable \"aws_region\" {\n  description = \"AWS region for all resources.\"\n  type    = string\n  default = \"us-east-1\"\n}\n\nvariable \"s3_bucket_prefix\" {\n  description = \"S3 bucket prefix for lambda code\"\n  type = string\n  default = \"apigw-http-api-lambda\"\n  \n}\n\nvariable \"lambda_name\" {\n  description = \"name of lambda function\"\n  type = string\n  default = \"test_apigw_integration\"\n}\n\nvariable \"lambda_log_retention\" {\n  description = \"lambda log retention in days\"\n  type = number\n  default = 7\n}\n\nvariable \"apigw_log_retention\" {\n  description = \"api gwy log retention in days\"\n  type = number\n  default = 7\n}\n"
  }
}